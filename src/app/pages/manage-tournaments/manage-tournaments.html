<div class="container-fluid">
  <div class="row">
    <div class="col-md-10 offset-md-1">
      <div class="d-flex align-items-center pt-3 pb-2">
        <button class="btn btn-outline-dark border-0 me-auto text-truncate" (click)="goBack()">
          <i class="bi bi-arrow-left"></i> Back
        </button>
        <div class="text-center mx-auto" style="max-width: 50%">
          <h5 class="mb-0 text-truncate">Tournaments</h5>
        </div>
        <button
          class="btn btn-outline-dark border-0 ms-auto text-truncate"
          style="opacity: 0; pointer-events: none"
        >
          Add <i class="bi bi-plus-lg"></i>
        </button>
      </div>

      <div class="d-flex align-items-center pt-0 pb-2">
        @if (user$ | async; as user) { @if (user.email) {
        <app-shared-layout
          title="Tournaments"
          icon="bi-trophy"
          [loading]="!(tournaments$ | async)"
          loadingText="Loading tournaments..."
          [showEmptyState]="!(tournaments$ | async)?.length"
          emptyText="No tournaments found. Create your first tournament!"
          emptyIcon="bi-trophy"
          emptyActionText="Create Tournament"
          emptyActionIcon="bi-plus-lg"
          [actions]="headerActions"
          class="w-100"
          (emptyAction)="openAddModal()"
        >
          <div *ngIf="tournaments$ | async as tournaments" class="row g-3" (click)="hideQRCode()">
            @for (tournament of tournaments; track tournament.id) {
            <div class="col-md-6 col-lg-4 col-xl-3">
              <div class="card h-100" (click)="$event.stopPropagation()">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h6 class="mb-0 text-truncate">{{ tournament.name }}</h6>
                  <ng-template #popTemplate>
                    <ul class="list-group p-1 shadow border">
                      <li
                        class="list-group-item"
                        role="button"
                        (click)="contentMenu.hide(); configureTournament(tournament.id!)"
                      >
                        <i class="bi bi-gear me-2"></i> Plan Tournament
                      </li>
                      <li
                        class="list-group-item"
                        role="button"
                        (click)="contentMenu.hide(); showQRCode(tournament)"
                      >
                        <i class="bi bi-qr-code me-2"></i> Show QR Code
                      </li>
                      <li
                        class="list-group-item"
                        role="button"
                        (click)="contentMenu.hide(); openEditModal(tournament)"
                      >
                        <i class="bi bi-pencil-fill me-2"></i> Edit Tournament
                      </li>
                      <li
                        class="list-group-item"
                        role="button"
                        (click)="contentMenu.hide(); delete(tournament)"
                      >
                        <i class="bi bi-trash me-2"></i> Delete Tournament
                      </li>
                    </ul>
                  </ng-template>
                  <button
                    type="button"
                    class="btn btn-outline-dark border-0 btn-sm"
                    #contentMenu="bs-popover"
                    [popover]="popTemplate"
                    container="body"
                    placement="bottom"
                    [outsideClick]="true"
                  >
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-1">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-controller text-dark me-2" style="font-size: 1.5rem"></i>
                      <span class="badge bg-warning text-dark fw-normal">{{
                        tournament.sport | titlecase
                      }}</span>
                    </div>
                    <div class="d-flex align-items-center">
                      <i
                        class="bi bi-calendar-event text-success me-2"
                        style="font-size: 1.5rem"
                      ></i>
                      <span>{{
                        formatDateForDisplay(tournament.startDate) | date : 'MMM dd, yyyy'
                      }}</span>
                    </div>
                  </div>
                  <div class="d-flex align-items-center">
                    <i class="bi bi-hash text-info me-2" style="font-size: 1.5rem"></i>
                    <small
                      class="font-monospace text-muted text-truncate"
                      appCopyToClipboard="{{ tournament.id }}"
                      copySuccessMessage="Tournament ID copied!"
                      style="cursor: pointer"
                      title="Click to copy Tournament ID"
                    >
                      {{ tournament.id }}
                      <i class="bi bi-copy ms-1"></i>
                    </small>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </app-shared-layout>

        <app-qr-code-modal
          [show]="!!selectedTournament"
          [tournamentId]="selectedTournament?.id || ''"
          [tournament]="selectedTournament"
          (closed)="hideQRCode()"
        >
        </app-qr-code-modal>

        } }
      </div>
    </div>
  </div>
</div>
