<div class="container-fluid h-100 d-flex flex-column">
  <!-- Header -->
  <div class="row bg-white shadow-sm p-3 mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <div>
        <button class="btn btn-outline-primary me-3" (click)="goBack()">
          <i class="fas fa-arrow-left me-2"></i>Back
        </button>
        <h4 class="mb-0 d-inline">Tournament Knockout Planning</h4>
      </div>
      <div>
        <button 
          class="btn btn-primary me-2" 
          (click)="generateBracket()" 
          [disabled]="!canGenerateBracket() || isGenerating">
          <i class="fas fa-sitemap me-2"></i>
          {{ isGenerating ? 'Generating...' : 'Generate Bracket' }}
        </button>
        <button 
          class="btn btn-outline-secondary" 
          (click)="resetBracket()" 
          *ngIf="knockoutTournament">
          <i class="fas fa-redo me-2"></i>Reset
        </button>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="row flex-grow-1">
    <!-- Team Selection Panel -->
    <div class="col-md-3" *ngIf="!knockoutTournament">
      <div class="card h-100">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-users me-2"></i>Select Teams
          </h5>
          <small class="text-muted">Choose teams for knockout (power of 2)</small>
        </div>
        <div class="card-body">
          <div class="alert alert-info" *ngIf="selectedTeams.length > 0 && !canGenerateBracket()">
            <i class="fas fa-info-circle me-2"></i>
            Select {{ getNextPowerOf2(selectedTeams.length) - selectedTeams.length }} more teams
          </div>
          
          <div class="team-list">
            <div 
              class="team-item p-3 mb-2 border rounded cursor-pointer"
              *ngFor="let team of teams"
              [class.selected]="isTeamSelected(team)"
              (click)="toggleTeamSelection(team)">
              <div class="d-flex align-items-center">
                <div class="form-check me-3">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    [checked]="isTeamSelected(team)"
                    readonly>
                </div>
                <div>
                  <h6 class="mb-1">{{ team.name }}</h6>
                  <small class="text-muted">{{ team.playerIds.length || 0 }} players</small>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-3" *ngIf="selectedTeams.length > 0">
            <h6>Selected Teams ({{ selectedTeams.length }})</h6>
            <div class="selected-teams">
              <span 
                class="badge bg-primary me-1 mb-1" 
                *ngFor="let team of selectedTeams">
                {{ team.name }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tournament Bracket -->
    <div [class]="knockoutTournament ? 'col-12' : 'col-md-9'">
      <div class="card h-100" *ngIf="knockoutTournament">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="fas fa-trophy me-2"></i>Tournament Bracket
          </h5>
          <span class="badge bg-success">{{ knockoutTournament.teams.length }} Teams</span>
        </div>
        <div class="card-body p-0">
          <div class="bracket-container">
            <div class="bracket-scroll">
              <div class="bracket-tree">
                <div 
                  class="bracket-round" 
                  *ngFor="let round of getRounds(); let roundIndex = index">
                  <div class="round-header">
                    <h6 class="text-center mb-3">{{ getRoundName(round) }}</h6>
                  </div>
                  <div class="matches-container">
                    <div 
                      class="match-card"
                      *ngFor="let match of getMatchesByRound(round); let matchIndex = index"
                      [style.margin-top.px]="getMatchMarginTop(round, matchIndex)">
                      
                      <div class="match-content">
                        <!-- Team 1 -->
                        <div 
                          class="team-slot"
                          [class.winner]="match.winner?.id === match.team1?.id"
                          [class.clickable]="match.team1 && match.team2 && !match.winner"
                          (click)="match.team1 && match.team2 && !match.winner && advanceWinner(match, match.team1)">
                          <div class="team-info">
                            <span class="team-name">{{ match.team1?.name || 'TBD' }}</span>
                            <i class="fas fa-crown winner-icon" *ngIf="match.winner?.id === match.team1?.id"></i>
                          </div>
                        </div>

                        <!-- VS Divider -->
                        <div class="vs-divider">
                          <span class="vs-text">VS</span>
                        </div>

                        <!-- Team 2 -->
                        <div 
                          class="team-slot"
                          [class.winner]="match.winner?.id === match.team2?.id"
                          [class.clickable]="match.team1 && match.team2 && !match.winner"
                          (click)="match.team1 && match.team2 && !match.winner && advanceWinner(match, match.team2)">
                          <div class="team-info">
                            <span class="team-name">{{ match.team2?.name || 'TBD' }}</span>
                            <i class="fas fa-crown winner-icon" *ngIf="match.winner?.id === match.team2?.id"></i>
                          </div>
                        </div>
                      </div>

                      <!-- Connection Line -->
                      <div class="connection-line" *ngIf="round < knockoutTournament!.totalRounds"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="card h-100 d-flex align-items-center justify-content-center" *ngIf="!knockoutTournament">
        <div class="text-center">
          <i class="fas fa-sitemap fa-4x text-muted mb-3"></i>
          <h5 class="text-muted">No Tournament Bracket Generated</h5>
          <p class="text-muted">Select teams from the left panel and click "Generate Bracket"</p>
        </div>
      </div>
    </div>
  </div>
</div>